# Due servizi in cartelle separate - Ottimizzato per Raspberry Pi 5
# Build: docker compose build
# Run:   docker compose up -d

services:
  raspi-status:
    container_name: raspi-status
    build:
      context: ./raspi-status
      dockerfile: Dockerfile
    ports:
      - "8080:8080"
    environment:
      - HOST_IP=192.168.0.30
    volumes:
      - /usr/bin/vcgencmd:/usr/bin/vcgencmd:ro
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - /proc:/host/proc:ro
      - /sys:/host/sys:ro
      - raspi-status-logs:/app/logs
    deploy:
      resources:
        limits:
          memory: 256M
    privileged: true
    network_mode: host
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "2"
    restart: unless-stopped

  ai-router:
    container_name: ai-router
    build:
      context: ./ai-router
      dockerfile: Dockerfile
    ports:
      - "7860:7860"
    volumes:
      - ./router_data/models:/app/models
      - ai-router-logs:/app/logs
    deploy:
      resources:
        limits:
          memory: 2G
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "2"
    restart: unless-stopped

volumes:
  raspi-status-logs:
  ai-router-logs:
